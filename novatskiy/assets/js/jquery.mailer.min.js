
/* author: Timur Valiyev | email: v.timur8484@gmail.com */

(function(){var t,r,e=function(t,r){return function(){return t.apply(r,arguments)}};t=jQuery,r=function(){function r(r,n){this.$form=r,this.onSubmit=e(this.onSubmit,this),t.extend(this.settings,n),"string"==typeof this.settings.recaptchaKey&&t.getScript(this.recaptchaJs),this.$form.bind("submit",this.onSubmit)}return r.prototype.settings={action:"/",method:"POST",dataType:"json",sendingStr:"Sending...",recaptchaKey:!1,success:function(t,r){},error:function(t){}},r.prototype.emailRegex=/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,r.prototype.recaptchaJs="https://www.google.com/recaptcha/api.js?onload=recaptchaOnLoad&render=explicit",r.prototype.process=!1,r.prototype.sendingCurrentHtml="",r.prototype.captchaArr=[],r.prototype.renderCaptcha=function(){return this.captchaArr=new Array,this.$form.each(function(r){return function(e,n){var i;return i=t(n).find(".js-mailer-recaptcha"),i.each(function(e,n){var i;return i=t(n),i.removeClass("verified"),r.captchaArr.push(grecaptcha.render(n,{sitekey:r.settings.recaptchaKey,size:"normal",theme:"light",callback:function(t){return i.addClass("verified")}}))})}}(this))},r.prototype.resetCaptcha=function(){var t,r,e,n;for(n=this.captchaArr,r=0,e=n.length;r<e;r++)t=n[r],grecaptcha.reset(t);return!0},r.prototype.onSubmit=function(r){var e;return r.preventDefault(),e=t(r.target),this.validate(e.find("[validate]"))&&!this.process&&this.send(e),!1},r.prototype.send=function(r){return this.process=!0,this.progress(r),t.ajax({method:this.settings.method,url:this.settings.action,data:r.serialize(),dataType:this.settings.dataType}).done(function(t){return function(e){return t.success(r,e)}}(this)).fail(function(t){return function(){return t.error(r)}}(this)).always(function(t){return function(){return t.process=!1,t.always(r)}}(this)),!0},r.prototype.success=function(t,r){return t.trigger("reset"),this.settings.success(t,r)},r.prototype.error=function(t){return this.settings.error(t)},r.prototype.always=function(r){var e;return e=r.find(".js-mailer-progress"),e.html(this.sendingCurrentHtml),t("[validate]").removeClass("verified"),this.resetCaptcha(),!0},r.prototype.progress=function(t){var r;return r=t.find(".js-mailer-progress"),this.sendingCurrentHtml=r.html(),r.html(this.settings.sendingStr),!0},r.prototype.inputError=function(r){var e;return e=r.parent(),e.addClass("has-error"),r.one("focusin",function(r){return t(this).parent().removeClass("has-error")}),!0},r.prototype.validate=function(r){var e;return e=!0,r.each(function(r){return function(n,i){var a,s,o,c;return a=t(i),c=a.attr("validate"),o=a.val(),s=function(){switch(c){case"text":return o.length>2;case"email":return this.emailRegex.test(o);case"recaptcha":return a.hasClass("verified");default:return!0}}.call(r),s||(e=s,r.inputError(a)),!0}}(this)),e},r}(),t.fn.extend({mailer:function(t){var e;return e=new r(this,t),window.recaptchaOnLoad=function(){return e.renderCaptcha()},e}})}).call(this);